<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancelar Reserva - Altior Traslados</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <!-- EmailJS SDK (para envío de correos) -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        .cancel-section .section-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .cancel-section .section-header h1 {
            color: #e74c3c;
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        
        .cancel-section .section-header p {
            color: #666;
            font-size: 1.2em;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Asegurar que el popup esté oculto por defecto */
        #confirmationPopup {
            display: none !important;
        }
        
        @media (max-width: 768px) {
            .cancel-section .section-header h1 {
                font-size: 2em;
            }
            
            .cancel-section .section-header p {
                font-size: 1em;
            }
        }
    </style>
</head>

<body>
    <!-- Social Media Sidebar -->
    <div class="social-sidebar">
        <a href="https://wa.me/5491122516700" target="_blank" class="social-icon whatsapp">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="mailto:altior.traslados@gmail.com" class="social-icon email">
            <i class="fas fa-envelope"></i>
        </a>
        <a href="https://www.facebook.com/p/Altior-Traslados-100075517674744" target="_blank"
            class="social-icon facebook">
            <i class="fab fa-facebook-f"></i>
        </a>
        <a href="#" class="social-icon instagram">
            <i class="fab fa-instagram"></i>
        </a>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo-section">
                <svg class="logo" viewBox="0 0 100 100">
                    <polygon points="50,15 85,75 50,60 15,75" fill="#5B8DB8" />
                    <polygon points="50,15 50,60 85,75" fill="#3B5998" />
                    <polygon points="50,15 15,75 50,60" fill="#2C4A7C" />
                </svg>
                <div class="brand-name">ALTIOR TRASLADOS</div>
            </div>
            
            <!-- Hamburger Menu -->
            <div class="hamburger-menu">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
            </div>
            
            <div class="nav-right">
                <a href="index.html" class="nav-link">Inicio</a>
                <a href="precios.html" class="nav-link">Precios</a>
                <span class="nav-link active">Cancelar Reserva</span>
                <div class="phone-number">
                    <i class="fas fa-phone"></i>
                    <span>+54 9 11 2251-6700</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Cancelar Reserva Section -->
    <section class="cancel-section">
        <div class="features-container">
            <div class="section-header">
                <h1>Cancelar Reserva</h1>
                <p>Ingrese su código de reserva para cancelar su traslado</p>
            </div>

            <div class="cancel-info">
                <div class="info-card">
                    <h3><i class="fas fa-info-circle"></i> Cómo cancelar su reserva</h3>
                    <ul>
                        <li>Localice su código de reserva en el correo de confirmación</li>
                        <li>Ingrese el código en el formulario a continuación</li>
                        <li>Confirme la cancelación siguiendo las instrucciones</li>
                        <li>Recibirá un correo de confirmación de cancelación</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3><i class="fas fa-exclamation-circle"></i> Políticas de cancelación</h3>
                    <ul>
                        <li>Cancelaciones con más de 24 horas de anticipación: Reembolso completo</li>
                        <li>Cancelaciones con menos de 24 horas: Reembolso del 50%</li>
                        <li>Cancelaciones el mismo día del servicio: Sin reembolso</li>
                        <li>En caso de vuelo cancelado: Reembolso completo con comprobante</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3><i class="fas fa-question-circle"></i> ¿Necesita ayuda?</h3>
                    <p>Si tiene alguna duda sobre su reserva o necesita asistencia, puede contactarnos:</p>
                    <div class="contact-options">
                        <div class="contact-option">
                            <i class="fab fa-whatsapp"></i>
                            <span>WhatsApp: +54 9 11 2251-6700</span>
                        </div>
                        <div class="contact-option">
                            <i class="fas fa-envelope"></i>
                            <span>Email: info@altiortraslados.com</span>
                        </div>
                        <div class="contact-option">
                            <i class="fas fa-phone"></i>
                            <span>Teléfono: +54 9 11 2251-6700</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cancel-form-container">
                <form id="cancelForm" class="booking-form">
                    <div class="form-group">
                        <label>Código de Reserva</label>
                        <input type="text" id="codigoReserva" name="codigoReserva" placeholder="Ej: ALT-XXXXXX-XXXXX"
                            required>
                    </div>

                    <button type="submit" class="btn-submit"
                        style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                        <i class="fas fa-times-circle"></i>
                        Cancelar Reserva
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Popup de confirmación -->
    <div id="confirmationPopup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <span class="popup-close">&times;</span>
            <h3>¡Reserva Cancelada!</h3>
            <p>Su reserva ha sido cancelada exitosamente.</p>
            <p>Recibirá un correo de confirmación con los detalles de la cancelación y cualquier reembolso aplicable.</p>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <svg viewBox="0 0 100 100" width="50" height="50">
                    <polygon points="50,15 85,75 50,60 15,75" fill="#5B8DB8" />
                    <polygon points="50,15 50,60 85,75" fill="#3B5998" />
                    <polygon points="50,15 15,75 50,60" fill="#2C4A7C" />
                </svg>
                <div class="footer-brand">ALTIOR TRASLADOS</div>
            </div>

            <!-- Footer Social Media -->
            <div class="footer-social">
                <a href="https://wa.me/5491122516700" target="_blank" class="social-icon whatsapp">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <a href="mailto:altior.traslados@gmail.com" class="social-icon email">
                    <i class="fas fa-envelope"></i>
                </a>
                <a href="https://www.facebook.com/p/Altior-Traslados-100075517674744" target="_blank"
                    class="social-icon facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="social-icon instagram">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>

            <p class="footer-text">&copy; 2024 Altior Traslados. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="js/hamburger-menu.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Funcionalidad del formulario de cancelación
        document.addEventListener('DOMContentLoaded', function() {
            const cancelForm = document.getElementById('cancelForm');
            const popup = document.getElementById('confirmationPopup');
            const closeButtons = document.querySelectorAll('.popup-close');
            
            // Asegurar que el popup esté oculto al cargar la página
            if (popup) {
                popup.style.display = 'none';
            }
            
            if (cancelForm) {
                cancelForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const codigoReserva = document.getElementById('codigoReserva').value;
                    
                    // Validación básica del código de reserva
                    if (codigoReserva && codigoReserva.length >= 10) {
                        // Procesar cancelación usando el backend real
                        procesarCancelacionConBackend(codigoReserva);
                    } else {
                        alert('Por favor ingrese un código de reserva válido (mínimo 10 caracteres).');
                    }
                });
            }
            
            // Cerrar popup
            if (closeButtons && closeButtons.length > 0) {
                closeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        if (popup) {
                            popup.style.display = 'none';
                        }
                    });
                });
            }
            
            // Cerrar popup al hacer clic fuera del contenido
            if (popup) {
                window.addEventListener('click', function(e) {
                    if (e.target === popup) {
                        popup.style.display = 'none';
                    }
                });
            }
            
            // Función para procesar la cancelación usando el backend real
            async function procesarCancelacionConBackend(codigoReserva) {
                try {
                    // Mostrar indicador de carga
                    const boton = cancelForm.querySelector('button[type="submit"]');
                    const textoOriginal = boton.innerHTML;
                    boton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
                    boton.disabled = true;
                    
                    // Verificar que el código de reserva sea válido usando el backend
                    const verificacion = await verificarCodigoReservaBackend(codigoReserva);
                    
                    if (!verificacion.exito || !verificacion.valido) {
                        // Restaurar botón
                        boton.innerHTML = textoOriginal;
                        boton.disabled = false;
                        alert(verificacion.mensaje || 'Código de reserva no válido o ya cancelado');
                        return;
                    }
                    
                    // Cancelar la reserva usando el backend
                    const resultado = await cancelarReservaBackend(codigoReserva);
                    
                    // Restaurar botón
                    boton.innerHTML = textoOriginal;
                    boton.disabled = false;
                    
                    if (resultado.exito && resultado.cancelada) {
                        // Mostrar popup de confirmación
                        if (popup) {
                            popup.style.display = 'flex';
                        }
                        cancelForm.reset();
                    } else {
                        alert(resultado.mensaje || 'Error al cancelar la reserva');
                    }
                } catch (error) {
                    // Restaurar botón
                    const boton = cancelForm.querySelector('button[type="submit"]');
                    boton.innerHTML = 'Cancelar Reserva';
                    boton.disabled = false;
                    
                    console.error('Error al procesar cancelación:', error);
                    alert('Error al procesar la cancelación. Por favor intente nuevamente.');
                }
            }
            
            // Función para verificar código de reserva usando el backend
            async function verificarCodigoReservaBackend(codigoReserva) {
                try {
                    const response = await fetch(`${RESERVAS_CONFIG.apiUrl}/verificar-reserva`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ codigoReserva: codigoReserva })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Error en la verificación');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Error al verificar código de reserva:', error);
                    return {
                        exito: false,
                        mensaje: 'Error al verificar el código de reserva'
                    };
                }
            }
            
            // Función para cancelar reserva usando el backend
            async function cancelarReservaBackend(codigoReserva) {
                try {
                    const response = await fetch(`${RESERVAS_CONFIG.apiUrl}/cancelar-reserva`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ codigoReserva: codigoReserva })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Error al cancelar reserva');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Error al cancelar reserva:', error);
                    return {
                        exito: false,
                        mensaje: 'Error al cancelar la reserva'
                    };
                }
            }
        });
    </script>
</body>

</html>